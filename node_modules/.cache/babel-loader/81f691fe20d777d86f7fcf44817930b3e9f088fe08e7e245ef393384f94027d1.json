{"ast":null,"code":"// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\nimport { SpanKind, setSpan, context as otContext, getTracer } from \"./interfaces\";\nimport { trace, INVALID_SPAN_CONTEXT } from \"@opentelemetry/api\";\nexport function isTracingDisabled() {\n  var _a;\n  if (typeof process === \"undefined\") {\n    // not supported in browser for now without polyfills\n    return false;\n  }\n  const azureTracingDisabledValue = (_a = process.env.AZURE_TRACING_DISABLED) === null || _a === void 0 ? void 0 : _a.toLowerCase();\n  if (azureTracingDisabledValue === \"false\" || azureTracingDisabledValue === \"0\") {\n    return false;\n  }\n  return Boolean(azureTracingDisabledValue);\n}\n/**\n * Creates a function that can be used to create spans using the global tracer.\n *\n * Usage:\n *\n * ```typescript\n * // once\n * const createSpan = createSpanFunction({ packagePrefix: \"Azure.Data.AppConfiguration\", namespace: \"Microsoft.AppConfiguration\" });\n *\n * // in each operation\n * const span = createSpan(\"deleteConfigurationSetting\", operationOptions);\n *    // code...\n * span.end();\n * ```\n *\n * @hidden\n * @param args - allows configuration of the prefix for each span as well as the az.namespace field.\n */\nexport function createSpanFunction(args) {\n  return function (operationName, operationOptions) {\n    const tracer = getTracer();\n    const tracingOptions = (operationOptions === null || operationOptions === void 0 ? void 0 : operationOptions.tracingOptions) || {};\n    const spanOptions = Object.assign({\n      kind: SpanKind.INTERNAL\n    }, tracingOptions.spanOptions);\n    const spanName = args.packagePrefix ? `${args.packagePrefix}.${operationName}` : operationName;\n    let span;\n    if (isTracingDisabled()) {\n      span = trace.wrapSpanContext(INVALID_SPAN_CONTEXT);\n    } else {\n      span = tracer.startSpan(spanName, spanOptions, tracingOptions.tracingContext);\n    }\n    if (args.namespace) {\n      span.setAttribute(\"az.namespace\", args.namespace);\n    }\n    let newSpanOptions = tracingOptions.spanOptions || {};\n    if (span.isRecording() && args.namespace) {\n      newSpanOptions = Object.assign(Object.assign({}, tracingOptions.spanOptions), {\n        attributes: Object.assign(Object.assign({}, spanOptions.attributes), {\n          \"az.namespace\": args.namespace\n        })\n      });\n    }\n    const newTracingOptions = Object.assign(Object.assign({}, tracingOptions), {\n      spanOptions: newSpanOptions,\n      tracingContext: setSpan(tracingOptions.tracingContext || otContext.active(), span)\n    });\n    const newOperationOptions = Object.assign(Object.assign({}, operationOptions), {\n      tracingOptions: newTracingOptions\n    });\n    return {\n      span,\n      updatedOptions: newOperationOptions\n    };\n  };\n}","map":{"version":3,"mappings":"AAAA;AACA;AAEA,SAIEA,QAAQ,EACRC,OAAO,EACPC,OAAO,IAAIC,SAAS,EACpBC,SAAS,QACJ,cAAc;AACrB,SAASC,KAAK,EAAEC,oBAAoB,QAAQ,oBAAoB;AAuBhE,OAAM,SAAUC,iBAAiB;;EAC/B,IAAI,OAAOC,OAAO,KAAK,WAAW,EAAE;IAClC;IACA,OAAO,KAAK;;EAGd,MAAMC,yBAAyB,GAAG,aAAO,CAACC,GAAG,CAACC,sBAAsB,0CAAEC,WAAW,EAAE;EAEnF,IAAIH,yBAAyB,KAAK,OAAO,IAAIA,yBAAyB,KAAK,GAAG,EAAE;IAC9E,OAAO,KAAK;;EAGd,OAAOI,OAAO,CAACJ,yBAAyB,CAAC;AAC3C;AAEA;;;;;;;;;;;;;;;;;;AAkBA,OAAM,SAAUK,kBAAkB,CAACC,IAA4B;EAC7D,OAAO,UACLC,aAAqB,EACrBC,gBAA+B;IAE/B,MAAMC,MAAM,GAAGd,SAAS,EAAE;IAC1B,MAAMe,cAAc,GAAG,iBAAgB,aAAhBF,gBAAgB,uBAAhBA,gBAAgB,CAAEE,cAAc,KAAI,EAAE;IAC7D,MAAMC,WAAW;MACfC,IAAI,EAAErB,QAAQ,CAACsB;IAAQ,GACpBH,cAAc,CAACC,WAAW,CAC9B;IAED,MAAMG,QAAQ,GAAGR,IAAI,CAACS,aAAa,GAAG,GAAGT,IAAI,CAACS,aAAa,IAAIR,aAAa,EAAE,GAAGA,aAAa;IAE9F,IAAIS,IAAU;IACd,IAAIlB,iBAAiB,EAAE,EAAE;MACvBkB,IAAI,GAAGpB,KAAK,CAACqB,eAAe,CAACpB,oBAAoB,CAAC;KACnD,MAAM;MACLmB,IAAI,GAAGP,MAAM,CAACS,SAAS,CAACJ,QAAQ,EAAEH,WAAW,EAAED,cAAc,CAACS,cAAc,CAAC;;IAG/E,IAAIb,IAAI,CAACc,SAAS,EAAE;MAClBJ,IAAI,CAACK,YAAY,CAAC,cAAc,EAAEf,IAAI,CAACc,SAAS,CAAC;;IAGnD,IAAIE,cAAc,GAAGZ,cAAc,CAACC,WAAW,IAAI,EAAE;IAErD,IAAIK,IAAI,CAACO,WAAW,EAAE,IAAIjB,IAAI,CAACc,SAAS,EAAE;MACxCE,cAAc,mCACTZ,cAAc,CAACC,WAAW;QAC7Ba,UAAU,kCACLb,WAAW,CAACa,UAAU;UACzB,cAAc,EAAElB,IAAI,CAACc;QAAS;MAAA,EAEjC;;IAGH,MAAMK,iBAAiB,mCAClBf,cAAc;MACjBC,WAAW,EAAEW,cAAc;MAC3BH,cAAc,EAAE3B,OAAO,CAACkB,cAAc,CAACS,cAAc,IAAIzB,SAAS,CAACgC,MAAM,EAAE,EAAEV,IAAI;IAAC,EACnF;IAED,MAAMW,mBAAmB,GAAGC,gCACvBpB,gBAAgB;MACnBE,cAAc,EAAEe;IAAiB,EAC2B;IAE9D,OAAO;MACLT,IAAI;MACJa,cAAc,EAAEF;KACjB;EACH,CAAC;AACH","names":["SpanKind","setSpan","context","otContext","getTracer","trace","INVALID_SPAN_CONTEXT","isTracingDisabled","process","azureTracingDisabledValue","env","AZURE_TRACING_DISABLED","toLowerCase","Boolean","createSpanFunction","args","operationName","operationOptions","tracer","tracingOptions","spanOptions","kind","INTERNAL","spanName","packagePrefix","span","wrapSpanContext","startSpan","tracingContext","namespace","setAttribute","newSpanOptions","isRecording","attributes","newTracingOptions","active","newOperationOptions","Object","updatedOptions"],"sources":["/Users/yupenglei/Documents/geo-react/node_modules/@azure/storage-blob/node_modules/@azure/core-tracing/src/createSpan.ts"],"sourcesContent":["// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport {\n  OperationTracingOptions,\n  Span,\n  SpanOptions,\n  SpanKind,\n  setSpan,\n  context as otContext,\n  getTracer\n} from \"./interfaces\";\nimport { trace, INVALID_SPAN_CONTEXT } from \"@opentelemetry/api\";\n\n/**\n * Arguments for `createSpanFunction` that allow you to specify the\n * prefix for each created span as well as the `az.namespace` attribute.\n *\n * @hidden\n */\nexport interface CreateSpanFunctionArgs {\n  /**\n   * Package name prefix.\n   *\n   * NOTE: if this is empty no prefix will be applied to created Span names.\n   */\n  packagePrefix: string;\n  /**\n   * Service namespace\n   *\n   * NOTE: if this is empty no `az.namespace` attribute will be added to created Spans.\n   */\n  namespace: string;\n}\n\nexport function isTracingDisabled(): boolean {\n  if (typeof process === \"undefined\") {\n    // not supported in browser for now without polyfills\n    return false;\n  }\n\n  const azureTracingDisabledValue = process.env.AZURE_TRACING_DISABLED?.toLowerCase();\n\n  if (azureTracingDisabledValue === \"false\" || azureTracingDisabledValue === \"0\") {\n    return false;\n  }\n\n  return Boolean(azureTracingDisabledValue);\n}\n\n/**\n * Creates a function that can be used to create spans using the global tracer.\n *\n * Usage:\n *\n * ```typescript\n * // once\n * const createSpan = createSpanFunction({ packagePrefix: \"Azure.Data.AppConfiguration\", namespace: \"Microsoft.AppConfiguration\" });\n *\n * // in each operation\n * const span = createSpan(\"deleteConfigurationSetting\", operationOptions);\n *    // code...\n * span.end();\n * ```\n *\n * @hidden\n * @param args - allows configuration of the prefix for each span as well as the az.namespace field.\n */\nexport function createSpanFunction(args: CreateSpanFunctionArgs) {\n  return function<T extends { tracingOptions?: OperationTracingOptions }>(\n    operationName: string,\n    operationOptions: T | undefined\n  ): { span: Span; updatedOptions: T } {\n    const tracer = getTracer();\n    const tracingOptions = operationOptions?.tracingOptions || {};\n    const spanOptions: SpanOptions = {\n      kind: SpanKind.INTERNAL,\n      ...tracingOptions.spanOptions\n    };\n\n    const spanName = args.packagePrefix ? `${args.packagePrefix}.${operationName}` : operationName;\n\n    let span: Span;\n    if (isTracingDisabled()) {\n      span = trace.wrapSpanContext(INVALID_SPAN_CONTEXT);\n    } else {\n      span = tracer.startSpan(spanName, spanOptions, tracingOptions.tracingContext);\n    }\n\n    if (args.namespace) {\n      span.setAttribute(\"az.namespace\", args.namespace);\n    }\n\n    let newSpanOptions = tracingOptions.spanOptions || {};\n\n    if (span.isRecording() && args.namespace) {\n      newSpanOptions = {\n        ...tracingOptions.spanOptions,\n        attributes: {\n          ...spanOptions.attributes,\n          \"az.namespace\": args.namespace\n        }\n      };\n    }\n\n    const newTracingOptions: Required<OperationTracingOptions> = {\n      ...tracingOptions,\n      spanOptions: newSpanOptions,\n      tracingContext: setSpan(tracingOptions.tracingContext || otContext.active(), span)\n    };\n\n    const newOperationOptions = {\n      ...operationOptions,\n      tracingOptions: newTracingOptions\n    } as T & { tracingOptions: Required<OperationTracingOptions> };\n\n    return {\n      span,\n      updatedOptions: newOperationOptions\n    };\n  };\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}