{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function () {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n        case 7:\n          op = _.ops.pop();\n          _.trys.pop();\n          continue;\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n            _.ops.push(op);\n            break;\n          }\n          if (t[2]) _.ops.pop();\n          _.trys.pop();\n          continue;\n      }\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar react_1 = __importStar(require(\"react\"));\nvar MicrosoftLoginButton_1 = __importDefault(require(\"./MicrosoftLoginButton\"));\nvar helpers_1 = require(\"./helpers\");\nvar MicrosoftLogin = function (_a) {\n  var graphScopes = _a.graphScopes,\n    clientId = _a.clientId,\n    tenantUrl = _a.tenantUrl,\n    redirectUri = _a.redirectUri,\n    postLogoutRedirectUri = _a.postLogoutRedirectUri,\n    children = _a.children,\n    buttonTheme = _a.buttonTheme,\n    className = _a.className,\n    _b = _a.withUserData,\n    withUserData = _b === void 0 ? false : _b,\n    authCallback = _a.authCallback,\n    _c = _a.forceRedirectStrategy,\n    forceRedirectStrategy = _c === void 0 ? false : _c,\n    prompt = _a.prompt,\n    debug = _a.debug,\n    useLocalStorageCache = _a.useLocalStorageCache;\n  var msalInstance = helpers_1.getUserAgentApp({\n    clientId: clientId,\n    tenantUrl: tenantUrl,\n    redirectUri: redirectUri,\n    postLogoutRedirectUri: postLogoutRedirectUri,\n    useLocalStorageCache: useLocalStorageCache\n  });\n  var scopes = helpers_1.getScopes(graphScopes);\n  var log = helpers_1.getLogger(debug);\n  if (!msalInstance) {\n    log(\"Initialization\", \"clientID broken or not provided\", true);\n    return null;\n  }\n  react_1.useEffect(function () {\n    msalInstance.handleRedirectCallback(function (error, authResponse) {\n      if (!error && authResponse) {\n        log(\"Fetch Azure AD 'token' with redirect SUCCEEDED\", authResponse);\n        log(\"Fetch Graph API 'access_token' in silent mode STARTED\");\n        getGraphAPITokenAndUser(true);\n      } else {\n        log(\"Fetch Azure AD 'token' with redirect FAILED\", error, true);\n        authCallback(error);\n      }\n    });\n  }, []);\n  // attempt silent login\n  // return msalInstance to user login handler on reload if token is present\n  react_1.useEffect(function () {\n    var clientToken = useLocalStorageCache ? localStorage.getItem(\"msal.idtoken\") : sessionStorage.getItem(\"msal.idtoken\");\n    clientToken && getGraphAPITokenAndUser(forceRedirectStrategy || helpers_1.checkToIE());\n  }, [msalInstance]);\n  var login = function () {\n    log(\"Login STARTED\");\n    if (forceRedirectStrategy || helpers_1.checkToIE()) {\n      redirectLogin();\n    } else {\n      popupLogin();\n    }\n  };\n  var finalStep = function (authResponseWithAccessToken) {\n    log(\"Fetch Graph API 'access_token' SUCCEEDED\", authResponseWithAccessToken);\n    if (withUserData) {\n      getUserData(authResponseWithAccessToken);\n    } else {\n      log(\"Login SUCCEEDED\");\n      authCallback(null, authResponseWithAccessToken, msalInstance);\n    }\n  };\n  var getGraphAPITokenAndUser = function (isRedirect) {\n    return __awaiter(void 0, void 0, void 0, function () {\n      var silentRes, err_1, popupRes, error_1;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            _a.trys.push([0, 8,, 9]);\n            _a.label = 1;\n          case 1:\n            _a.trys.push([1, 3,, 7]);\n            return [4 /*yield*/, msalInstance.acquireTokenSilent({\n              scopes: scopes\n            })];\n          case 2:\n            silentRes = _a.sent();\n            finalStep(silentRes);\n            return [3 /*break*/, 7];\n          case 3:\n            err_1 = _a.sent();\n            log(\"Fetch Graph API 'access_token' in silent mode is FAILED\", err_1, true);\n            if (!isRedirect) return [3 /*break*/, 4];\n            log(\"Fetch Graph API 'access_token' with redirect STARTED\");\n            msalInstance.acquireTokenRedirect({\n              scopes: scopes\n            });\n            return [3 /*break*/, 6];\n          case 4:\n            log(\"Fetch Graph API 'access_token' with popup STARTED\");\n            return [4 /*yield*/, msalInstance.acquireTokenPopup({\n              scopes: scopes\n            })];\n          case 5:\n            popupRes = _a.sent();\n            finalStep(popupRes);\n            _a.label = 6;\n          case 6:\n            return [3 /*break*/, 7];\n          case 7:\n            return [3 /*break*/, 9];\n          case 8:\n            error_1 = _a.sent();\n            log(\"Login FAILED\", error_1, true);\n            authCallback(error_1);\n            return [3 /*break*/, 9];\n          case 9:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  var popupLogin = function () {\n    return __awaiter(void 0, void 0, void 0, function () {\n      var authResponse, err_2;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            log(\"Fetch Azure AD 'token' with popup STARTED\");\n            _a.label = 1;\n          case 1:\n            _a.trys.push([1, 3,, 4]);\n            return [4 /*yield*/, msalInstance.loginPopup({\n              scopes: scopes,\n              prompt: prompt\n            })];\n          case 2:\n            authResponse = _a.sent();\n            log(\"Fetch Azure AD 'token' with popup SUCCEEDED\", authResponse);\n            log(\"Fetch Graph API 'access_token' in silent mode STARTED\");\n            getGraphAPITokenAndUser();\n            return [3 /*break*/, 4];\n          case 3:\n            err_2 = _a.sent();\n            log(\"Fetch Azure AD 'token' with popup FAILED\", err_2, true);\n            authCallback(err_2);\n            return [3 /*break*/, 4];\n          case 4:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  var redirectLogin = function () {\n    log(\"Fetch Azure AD 'token' with redirect STARTED\");\n    msalInstance.loginRedirect({\n      scopes: scopes,\n      prompt: prompt\n    });\n  };\n  var getUserData = function (authResponseWithAccessToken) {\n    return __awaiter(void 0, void 0, void 0, function () {\n      var accessToken, options, response, userData;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            accessToken = authResponseWithAccessToken.accessToken;\n            log(\"Fetch Graph API user data STARTED\");\n            options = {\n              method: \"GET\",\n              headers: {\n                Authorization: \"Bearer \" + accessToken\n              }\n            };\n            return [4 /*yield*/, fetch(\"https://graph.microsoft.com/v1.0/me\", options)];\n          case 1:\n            response = _a.sent();\n            return [4 /*yield*/, response.json()];\n          case 2:\n            userData = _a.sent();\n            log(\"Fetch Graph API user data SUCCEEDED\", userData);\n            log(\"Login SUCCEEDED\");\n            authCallback(null, __assign(__assign({}, userData), authResponseWithAccessToken), msalInstance);\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  return children ? react_1.default.createElement(\"div\", {\n    onClick: login\n  }, children) : react_1.default.createElement(MicrosoftLoginButton_1.default, {\n    buttonTheme: buttonTheme || \"light\",\n    buttonClassName: className,\n    onClick: login\n  });\n};\nexports.default = MicrosoftLogin;","map":{"version":3,"mappings":"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","names":["MicrosoftLogin","_a","graphScopes","clientId","tenantUrl","redirectUri","postLogoutRedirectUri","children","buttonTheme","className","_b","withUserData","authCallback","_c","forceRedirectStrategy","prompt","debug","useLocalStorageCache","msalInstance","helpers_1","scopes","log","react_1","handleRedirectCallback","error","authResponse","getGraphAPITokenAndUser","clientToken","localStorage","getItem","sessionStorage","login","redirectLogin","popupLogin","finalStep","authResponseWithAccessToken","getUserData","isRedirect","acquireTokenSilent","silentRes","err_1","acquireTokenRedirect","acquireTokenPopup","popupRes","error_1","loginPopup","err_2","loginRedirect","accessToken","options","method","headers","Authorization","fetch","response","json","userData","onClick","MicrosoftLoginButton_1","buttonClassName","exports"],"sourceRoot":"","sources":["../src/MicrosoftLogin.tsx"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}