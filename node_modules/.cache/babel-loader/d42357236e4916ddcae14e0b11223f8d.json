{"ast":null,"code":"module.exports = /******/function () {\n  // webpackBootstrap\n  /******/\n  \"use strict\";\n\n  /******/\n  var __webpack_modules__ = {\n    /***/\"./src/index.ts\": /***/function (__unused_webpack_module, __webpack_exports__, __webpack_require__) {\n      // ESM COMPAT FLAG\n      __webpack_require__.r(__webpack_exports__);\n\n      // EXPORTS\n      __webpack_require__.d(__webpack_exports__, {\n        \"Upload\": function () {\n          return (/* reexport */Upload\n          );\n        },\n        \"UploadApiError\": function () {\n          return (/* reexport */UploadApiError\n          );\n        }\n      });\n      ; // CONCATENATED MODULE: external \"@upload-io/upload-api-client-upload-js\"\n      var upload_api_client_upload_js_namespaceObject = require(\"@upload-io/upload-api-client-upload-js\");\n      ;\n      ; // CONCATENATED MODULE: ./src/Mutex.ts\n      /**\n       * A lightweight mutex. (Other libraries contain too many features and we want to keep the size upload-js down).\n       *\n       * Characteristics:\n       * - Non-reentrant.\n       * - Unfair. (Multiple callers awaiting 'acquire' will be granted the mutex in no order.)\n       *   - When calling `safe` consecutively with no 'awaits' in-between, the current context will synchronously acquire\n       *     the mutex every time.\n       */\n      function _call(body, then, direct) {\n        if (direct) {\n          return then ? then(body()) : body();\n        }\n        try {\n          var result = Promise.resolve(body());\n          return then ? result.then(then) : result;\n        } catch (e) {\n          return Promise.reject(e);\n        }\n      }\n      function _rethrow(thrown, value) {\n        if (thrown) throw value;\n        return value;\n      }\n      function _finallyRethrows(body, finalizer) {\n        try {\n          var result = body();\n        } catch (e) {\n          return finalizer(true, e);\n        }\n        if (result && result.then) {\n          return result.then(finalizer.bind(null, false), finalizer.bind(null, true));\n        }\n        return finalizer(false, result);\n      }\n      function _empty() {}\n      function _awaitIgnored(value, direct) {\n        if (!direct) {\n          return value && value.then ? value.then(_empty) : Promise.resolve();\n        }\n      }\n      function _settle(pact, state, value) {\n        if (!pact.s) {\n          if (value instanceof _Pact) {\n            if (value.s) {\n              if (state & 1) {\n                state = value.s;\n              }\n              value = value.v;\n            } else {\n              value.o = _settle.bind(null, pact, state);\n              return;\n            }\n          }\n          if (value && value.then) {\n            value.then(_settle.bind(null, pact, state), _settle.bind(null, pact, 2));\n            return;\n          }\n          pact.s = state;\n          pact.v = value;\n          var observer = pact.o;\n          if (observer) {\n            observer(pact);\n          }\n        }\n      }\n      var _Pact = /*#__PURE__*/function () {\n        function _Pact() {}\n        _Pact.prototype.then = function (onFulfilled, onRejected) {\n          var result = new _Pact();\n          var state = this.s;\n          if (state) {\n            var callback = state & 1 ? onFulfilled : onRejected;\n            if (callback) {\n              try {\n                _settle(result, 1, callback(this.v));\n              } catch (e) {\n                _settle(result, 2, e);\n              }\n              return result;\n            } else {\n              return this;\n            }\n          }\n          this.o = function (_this) {\n            try {\n              var value = _this.v;\n              if (_this.s & 1) {\n                _settle(result, 1, onFulfilled ? onFulfilled(value) : value);\n              } else if (onRejected) {\n                _settle(result, 1, onRejected(value));\n              } else {\n                _settle(result, 2, value);\n              }\n            } catch (e) {\n              _settle(result, 2, e);\n            }\n          };\n          return result;\n        };\n        return _Pact;\n      }();\n      function _isSettledPact(thenable) {\n        return thenable instanceof _Pact && thenable.s & 1;\n      }\n      function _for(test, update, body) {\n        var stage;\n        for (;;) {\n          var shouldContinue = test();\n          if (_isSettledPact(shouldContinue)) {\n            shouldContinue = shouldContinue.v;\n          }\n          if (!shouldContinue) {\n            return result;\n          }\n          if (shouldContinue.then) {\n            stage = 0;\n            break;\n          }\n          var result = body();\n          if (result && result.then) {\n            if (_isSettledPact(result)) {\n              result = result.s;\n            } else {\n              stage = 1;\n              break;\n            }\n          }\n          if (update) {\n            var updateValue = update();\n            if (updateValue && updateValue.then && !_isSettledPact(updateValue)) {\n              stage = 2;\n              break;\n            }\n          }\n        }\n        var pact = new _Pact();\n        var reject = _settle.bind(null, pact, 2);\n        (stage === 0 ? shouldContinue.then(_resumeAfterTest) : stage === 1 ? result.then(_resumeAfterBody) : updateValue.then(_resumeAfterUpdate)).then(void 0, reject);\n        return pact;\n        function _resumeAfterBody(value) {\n          result = value;\n          do {\n            if (update) {\n              updateValue = update();\n              if (updateValue && updateValue.then && !_isSettledPact(updateValue)) {\n                updateValue.then(_resumeAfterUpdate).then(void 0, reject);\n                return;\n              }\n            }\n            shouldContinue = test();\n            if (!shouldContinue || _isSettledPact(shouldContinue) && !shouldContinue.v) {\n              _settle(pact, 1, result);\n              return;\n            }\n            if (shouldContinue.then) {\n              shouldContinue.then(_resumeAfterTest).then(void 0, reject);\n              return;\n            }\n            result = body();\n            if (_isSettledPact(result)) {\n              result = result.v;\n            }\n          } while (!result || !result.then);\n          result.then(_resumeAfterBody).then(void 0, reject);\n        }\n        function _resumeAfterTest(shouldContinue) {\n          if (shouldContinue) {\n            result = body();\n            if (result && result.then) {\n              result.then(_resumeAfterBody).then(void 0, reject);\n            } else {\n              _resumeAfterBody(result);\n            }\n          } else {\n            _settle(pact, 1, result);\n          }\n        }\n        function _resumeAfterUpdate() {\n          if (shouldContinue = test()) {\n            if (shouldContinue.then) {\n              shouldContinue.then(_resumeAfterTest).then(void 0, reject);\n            } else {\n              _resumeAfterTest(shouldContinue);\n            }\n          } else {\n            _settle(pact, 1, result);\n          }\n        }\n      }\n      function _continue(value, then) {\n        return value && value.then ? value.then(then) : then(value);\n      }\n      function _async(f) {\n        return function () {\n          for (var args = [], i = 0; i < arguments.length; i++) {\n            args[i] = arguments[i];\n          }\n          try {\n            return Promise.resolve(f.apply(this, args));\n          } catch (e) {\n            return Promise.reject(e);\n          }\n        };\n      }\n      function Mutex() {\n        var mutex;\n        var resolver;\n        var safe = function safe(callback) {\n          return _call(acquire, function () {\n            return _finallyRethrows(callback, function (_wasThrown, _result) {\n              release();\n              return _rethrow(_wasThrown, _result);\n            });\n          });\n        };\n        var acquire = _async(function () {\n          // Loop necessary for when multiple calls are made to 'acquire' before a 'release' is called, else the call to\n          // 'release' will resume every caller currently waiting on 'acquire'.\n          // eslint-disable-next-line no-unmodified-loop-condition\n          return _continue(_for(function () {\n            return mutex !== undefined;\n          }, void 0, function () {\n            return _awaitIgnored(mutex);\n          }), function () {\n            mutex = new Promise(function (resolve) {\n              resolver = resolve;\n            });\n          });\n        });\n        var release = function release() {\n          if (resolver === undefined) {\n            throw new Error(\"Unable to release mutex: already released.\");\n          }\n          resolver();\n          resolver = undefined;\n          mutex = undefined;\n        };\n        return {\n          safe: safe\n        };\n      }\n      ; // CONCATENATED MODULE: external \"progress-smoother\"\n      var external_progress_smoother_namespaceObject = require(\"progress-smoother\");\n      ;\n      ; // CONCATENATED MODULE: ./src/UploadApiError.ts\n      function _typeof(obj) {\n        \"@babel/helpers - typeof\";\n\n        return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n          return typeof obj;\n        } : function (obj) {\n          return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n        }, _typeof(obj);\n      }\n      function _defineProperties(target, props) {\n        for (var i = 0; i < props.length; i++) {\n          var descriptor = props[i];\n          descriptor.enumerable = descriptor.enumerable || false;\n          descriptor.configurable = true;\n          if (\"value\" in descriptor) descriptor.writable = true;\n          Object.defineProperty(target, descriptor.key, descriptor);\n        }\n      }\n      function _createClass(Constructor, protoProps, staticProps) {\n        if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n        if (staticProps) _defineProperties(Constructor, staticProps);\n        Object.defineProperty(Constructor, \"prototype\", {\n          writable: false\n        });\n        return Constructor;\n      }\n      function _classCallCheck(instance, Constructor) {\n        if (!(instance instanceof Constructor)) {\n          throw new TypeError(\"Cannot call a class as a function\");\n        }\n      }\n      function _inherits(subClass, superClass) {\n        if (typeof superClass !== \"function\" && superClass !== null) {\n          throw new TypeError(\"Super expression must either be null or a function\");\n        }\n        subClass.prototype = Object.create(superClass && superClass.prototype, {\n          constructor: {\n            value: subClass,\n            writable: true,\n            configurable: true\n          }\n        });\n        Object.defineProperty(subClass, \"prototype\", {\n          writable: false\n        });\n        if (superClass) _setPrototypeOf(subClass, superClass);\n      }\n      function _createSuper(Derived) {\n        var hasNativeReflectConstruct = _isNativeReflectConstruct();\n        return function _createSuperInternal() {\n          var Super = _getPrototypeOf(Derived),\n            result;\n          if (hasNativeReflectConstruct) {\n            var NewTarget = _getPrototypeOf(this).constructor;\n            result = Reflect.construct(Super, arguments, NewTarget);\n          } else {\n            result = Super.apply(this, arguments);\n          }\n          return _possibleConstructorReturn(this, result);\n        };\n      }\n      function _possibleConstructorReturn(self, call) {\n        if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n          return call;\n        } else if (call !== void 0) {\n          throw new TypeError(\"Derived constructors may only return object or undefined\");\n        }\n        return _assertThisInitialized(self);\n      }\n      function _assertThisInitialized(self) {\n        if (self === void 0) {\n          throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n        }\n        return self;\n      }\n      function _wrapNativeSuper(Class) {\n        var _cache = typeof Map === \"function\" ? new Map() : undefined;\n        _wrapNativeSuper = function _wrapNativeSuper(Class) {\n          if (Class === null || !_isNativeFunction(Class)) return Class;\n          if (typeof Class !== \"function\") {\n            throw new TypeError(\"Super expression must either be null or a function\");\n          }\n          if (typeof _cache !== \"undefined\") {\n            if (_cache.has(Class)) return _cache.get(Class);\n            _cache.set(Class, Wrapper);\n          }\n          function Wrapper() {\n            return _construct(Class, arguments, _getPrototypeOf(this).constructor);\n          }\n          Wrapper.prototype = Object.create(Class.prototype, {\n            constructor: {\n              value: Wrapper,\n              enumerable: false,\n              writable: true,\n              configurable: true\n            }\n          });\n          return _setPrototypeOf(Wrapper, Class);\n        };\n        return _wrapNativeSuper(Class);\n      }\n      function _construct(Parent, args, Class) {\n        if (_isNativeReflectConstruct()) {\n          _construct = Reflect.construct;\n        } else {\n          _construct = function _construct(Parent, args, Class) {\n            var a = [null];\n            a.push.apply(a, args);\n            var Constructor = Function.bind.apply(Parent, a);\n            var instance = new Constructor();\n            if (Class) _setPrototypeOf(instance, Class.prototype);\n            return instance;\n          };\n        }\n        return _construct.apply(null, arguments);\n      }\n      function _isNativeReflectConstruct() {\n        if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n        if (Reflect.construct.sham) return false;\n        if (typeof Proxy === \"function\") return true;\n        try {\n          Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n          return true;\n        } catch (e) {\n          return false;\n        }\n      }\n      function _isNativeFunction(fn) {\n        return Function.toString.call(fn).indexOf(\"[native code]\") !== -1;\n      }\n      function _setPrototypeOf(o, p) {\n        _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n          o.__proto__ = p;\n          return o;\n        };\n        return _setPrototypeOf(o, p);\n      }\n      function _getPrototypeOf(o) {\n        _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n          return o.__proto__ || Object.getPrototypeOf(o);\n        };\n        return _getPrototypeOf(o);\n      }\n      var UploadApiError = /*#__PURE__*/function (_Error) {\n        _inherits(UploadApiError, _Error);\n        var _super = _createSuper(UploadApiError);\n        function UploadApiError(response) {\n          var _this;\n          _classCallCheck(this, UploadApiError);\n          _this = _super.call(this, response.error.message);\n          _this.errorCode = response.error.code;\n          _this.details = response.error.details;\n          return _this;\n        }\n        return _createClass(UploadApiError);\n      }( /*#__PURE__*/_wrapNativeSuper(Error));\n      ; // CONCATENATED MODULE: ./src/Upload.ts\n      function Upload_rethrow(thrown, value) {\n        if (thrown) throw value;\n        return value;\n      }\n      function Upload_finallyRethrows(body, finalizer) {\n        try {\n          var result = body();\n        } catch (e) {\n          return finalizer(true, e);\n        }\n        if (result && result.then) {\n          return result.then(finalizer.bind(null, false), finalizer.bind(null, true));\n        }\n        return finalizer(false, result);\n      }\n      function _continueIgnored(value) {\n        if (value && value.then) {\n          return value.then(Upload_empty);\n        }\n      }\n      function _toConsumableArray(arr) {\n        return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n      }\n      function _nonIterableSpread() {\n        throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n      }\n      function _unsupportedIterableToArray(o, minLen) {\n        if (!o) return;\n        if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n        var n = Object.prototype.toString.call(o).slice(8, -1);\n        if (n === \"Object\" && o.constructor) n = o.constructor.name;\n        if (n === \"Map\" || n === \"Set\") return Array.from(o);\n        if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n      }\n      function _iterableToArray(iter) {\n        if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n      }\n      function _arrayWithoutHoles(arr) {\n        if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n      }\n      function _arrayLikeToArray(arr, len) {\n        if (len == null || len > arr.length) len = arr.length;\n        for (var i = 0, arr2 = new Array(len); i < len; i++) {\n          arr2[i] = arr[i];\n        }\n        return arr2;\n      }\n      function Upload_empty() {}\n      var accountIdLength = 7; // Sync with: upload/shared/**/AccountIdUtils\n\n      function Upload_awaitIgnored(value, direct) {\n        if (!direct) {\n          return value && value.then ? value.then(Upload_empty) : Promise.resolve();\n        }\n      }\n      var specialApiKeyAccountId = \"W142hJk\";\n      function Upload_call(body, then, direct) {\n        if (direct) {\n          return then ? then(body()) : body();\n        }\n        try {\n          var result = Promise.resolve(body());\n          return then ? result.then(then) : result;\n        } catch (e) {\n          return Promise.reject(e);\n        }\n      }\n      var specialApiKeys = [\"free\", \"demo\"];\n      function Upload_async(f) {\n        return function () {\n          for (var args = [], i = 0; i < arguments.length; i++) {\n            args[i] = arguments[i];\n          }\n          try {\n            return Promise.resolve(f.apply(this, args));\n          } catch (e) {\n            return Promise.reject(e);\n          }\n        };\n      }\n      var apiKeyPrefix = \"public_\";\n      function _callIgnored(body, direct) {\n        return Upload_call(body, Upload_empty, direct);\n      }\n      var maxUploadConcurrency = 5;\n      function _await(value, then, direct) {\n        if (direct) {\n          return then ? then(value) : value;\n        }\n        if (!value || !value.then) {\n          value = Promise.resolve(value);\n        }\n        return then ? value.then(then) : value;\n      }\n      var refreshBeforeExpirySeconds = 20;\n      function _catch(body, recover) {\n        try {\n          var result = body();\n        } catch (e) {\n          return recover(e);\n        }\n        if (result && result.then) {\n          return result.then(void 0, recover);\n        }\n        return result;\n      }\n      var onProgressInterval = 100;\n      function _invokeIgnored(body) {\n        var result = body();\n        if (result && result.then) {\n          return result.then(Upload_empty);\n        }\n      }\n      var retryAuthAfterErrorSeconds = 5;\n      var accessTokenPathBase = \"/api/v1/access_tokens/\";\n      var logPrefix = \"[upload-js] \";\n      /**\n       * You should instantiate one instance of this class in your web app.\n       *\n       * Try using:\n       *\n       *    Upload({apiKey: \"free\"})\n       *\n       * This is particularly important when using the 'beginAuthSession' and\n       * 'endAuthSession' methods, as you don't want multiple running instances of the\n       * auth process in your web application.\n       */\n\n      function Upload(config) {\n        // ----------------\n        // READONLY MEMBERS\n        // ----------------\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j;\n        var accountId;\n        var authMutex = Mutex();\n        var apiUrl = (_b = (_a = config.internal) === null || _a === void 0 ? void 0 : _a.apiUrl) !== null && _b !== void 0 ? _b : \"https://api.upload.io\";\n        var cdnUrl = (_d = (_c = config.internal) === null || _c === void 0 ? void 0 : _c.cdnUrl) !== null && _d !== void 0 ? _d : \"https://upcdn.io\";\n        var authenticateWithApiKey = (_f = (_e = config.internal) === null || _e === void 0 ? void 0 : _e.authenticateWithApiKey) !== null && _f !== void 0 ? _f : true;\n        var headers = (_g = config.internal) === null || _g === void 0 ? void 0 : _g.headers;\n        var debugMode = config.debug === true; // ------------------\n        // READ/WRITE MEMBERS\n        // ------------------\n\n        var lastAuthSession; // ----------------\n        // CONSTRUCTOR\n        // ----------------\n\n        if ((config !== null && config !== void 0 ? config : undefined) === undefined) {\n          throw new Error(\"\".concat(logPrefix, \"Config parameter required.\"));\n        }\n        if (config.debug === true) {\n          console.log(\"\".concat(logPrefix, \"Initialized with API key '\").concat(config.apiKey, \"'\"));\n        }\n        if (((_h = config.apiKey) !== null && _h !== void 0 ? _h : undefined) === undefined) {\n          throw new Error(\"\".concat(logPrefix, \"Please provide an API key via the 'apiKey' config parameter.\"));\n        }\n        if (config.apiKey.trim() !== config.apiKey) {\n          // We do not support API keys with whitespace (by trimming ourselves) because otherwise we'd need to support this\n          // everywhere in perpetuity (since removing the trimming would be a breaking change).\n          throw new Error(\"\".concat(logPrefix, \"API key needs trimming (whitespace detected).\"));\n        } // Non-api-key authentication is required by Upload Dashboard, which uses bearer tokens instead of API keys because\n        // the user may not have any active API keys, but might still want to upload files via the Upload Dashboard.\n\n        if (((_j = config.internal) === null || _j === void 0 ? void 0 : _j.authenticateWithApiKey) === false) {\n          accountId = config.internal.accountId;\n        } else {\n          if (specialApiKeys.includes(config.apiKey)) {\n            accountId = specialApiKeyAccountId;\n          } else {\n            if (!config.apiKey.startsWith(apiKeyPrefix)) {\n              throw new Error(\"\".concat(logPrefix, \"API key must begin with \\\"\").concat(apiKeyPrefix, \"\\\".\"));\n            }\n            accountId = config.apiKey.substr(apiKeyPrefix.length, accountIdLength);\n            if (accountId.length !== accountIdLength) {\n              throw new Error(\"\".concat(logPrefix, \"API key is too short!\"));\n            }\n          }\n        }\n        var accessTokenPath = \"\".concat(cdnUrl).concat(accessTokenPathBase).concat(accountId); // ----------------\n        // PUBLIC METHODS\n        // ----------------\n\n        var beginAuthSession = function beginAuthSession(authUrl, authHeaders) {\n          return Upload_call(endAuthSession, function () {\n            var authSession = {\n              accessToken: undefined,\n              accessTokenRefreshHandle: undefined,\n              isActive: true\n            }; // Does not need to be inside the mutex since the environment is single-threaded, and we have not async-yielded\n            // since the mutex from 'endAuthSession' was relinquished (meaning we still have execution, so we know a) nothing\n            // can interject and b) nothing has interjected since the lock was relinquished).\n\n            lastAuthSession = authSession;\n            return Upload_awaitIgnored(refreshAccessToken(authUrl, authHeaders, authSession));\n          });\n        };\n        var endAuthSession = Upload_async(function () {\n          return Upload_awaitIgnored(authMutex.safe(Upload_async(function () {\n            if (lastAuthSession === undefined) {\n              return;\n            }\n            var authSession = lastAuthSession;\n            lastAuthSession = undefined;\n            if (authSession.accessTokenRefreshHandle !== undefined) {\n              clearTimeout(authSession.accessTokenRefreshHandle);\n            }\n            authSession.isActive = false;\n            return _callIgnored(deleteAccessToken);\n          })));\n        });\n        var uploadFile = Upload_async(function (file) {\n          var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n          // Initial progress (raised immediately and synchronously).\n          var cancellationHandlers = [];\n          var addCancellationHandler = function addCancellationHandler(ca) {\n            cancellationHandlers.push(ca);\n          };\n          var cancel = function cancel() {\n            return cancellationHandlers.forEach(function (x) {\n              return x();\n            });\n          };\n          if (params.onBegin !== undefined) {\n            params.onBegin({\n              cancel: cancel\n            });\n          }\n          return _catch(function () {\n            return _await(beginFileUpload(file, params, addCancellationHandler));\n          }, function (e) {\n            cancel();\n            throw e;\n          });\n        });\n        var url = function url(filePath, slugOrParams) {\n          var _a;\n          var defaultSlug = \"raw\";\n          var params = typeof slugOrParams === \"string\" ? {\n            transformation: slugOrParams\n          } : slugOrParams;\n          return \"\".concat(cdnUrl, \"/\").concat(accountId, \"/\").concat((_a = params === null || params === void 0 ? void 0 : params.transformation) !== null && _a !== void 0 ? _a : defaultSlug).concat(filePath).concat((params === null || params === void 0 ? void 0 : params.auth) === true ? \"?_auth=true\" : \"\");\n        }; // ----------------\n        // PRIVATE METHODS\n        // ----------------\n\n        var beginFileUpload = Upload_async(function (file, params, addCancellationHandler) {\n          var progressSmoother = (0, external_progress_smoother_namespaceObject.ProgressSmoother)({\n            maxValue: file.size,\n            teardownTime: 1000,\n            minDelayUntilFirstValue: 2000,\n            valueIncreaseDelta: 200 * 1024,\n            valueIncreaseRatePerSecond: 50 * 1024,\n            averageTimeBetweenValues: 1000 // When running, XHR should (hopefully) report at least every second, regardless of connection speed.\n          });\n\n          var reportProgress = function reportProgress(stopReportingProgress) {\n            if (params.onProgress === undefined) {\n              stopReportingProgress(); // Important to call this, as outer function awaits this call when the download ends.\n            } else {\n              var bytesSent = progressSmoother.smoothedValue();\n              var bytesTotal = file.size;\n              if (bytesSent === bytesTotal) {\n                stopReportingProgress();\n              }\n              params.onProgress({\n                bytesSent: bytesSent,\n                bytesTotal: bytesTotal,\n                progress: Math.round(bytesSent / bytesTotal * 100)\n              });\n            }\n          };\n          return withProgressReporting(onProgressInterval, reportProgress, Upload_async(function () {\n            var uploadRequest = {\n              path: params.path,\n              metadata: params.metadata,\n              mime: normalizeMimeType(file.type),\n              originalFileName: file.name,\n              protocol: \"1.1\",\n              size: file.size,\n              tags: params.tags\n            };\n            debug(\"Initiating file upload. Params = \".concat(JSON.stringify(uploadRequest)));\n            return _await((0, upload_api_client_upload_js_namespaceObject.beginMultipartUpload)(getConfig(), accountId, uploadRequest), function (_beginMultipartUpload) {\n              var uploadMetadata = handleApiResult(_beginMultipartUpload);\n              debug(\"Initiated file upload. Metadata = \".concat(JSON.stringify(uploadMetadata)));\n              var incUploadIndex = function () {\n                var lastUploadIndex = 0;\n                return function () {\n                  if (lastUploadIndex === uploadMetadata.uploadParts.count - 1) {\n                    return undefined;\n                  }\n                  return ++lastUploadIndex;\n                };\n              }();\n              var nextPartQueue = [uploadMetadata.uploadParts.first];\n              var getNextPart = Upload_async(function (workerIndex) {\n                var nextPart = nextPartQueue.pop();\n                if (nextPart !== undefined) {\n                  debug(\"Dequeued part \".concat(nextPart.uploadPartIndex, \".\"), workerIndex);\n                  return nextPart;\n                }\n                var uploadPartIndex = incUploadIndex();\n                if (uploadPartIndex === undefined) {\n                  debug(\"No parts remaining.\", workerIndex);\n                  return undefined;\n                }\n                debug(\"Fetching metadata for part \".concat(uploadPartIndex, \".\"), workerIndex);\n                return _await((0, upload_api_client_upload_js_namespaceObject.getUploadPart)(getConfig(), accountId, uploadMetadata.uploadId, uploadPartIndex), handleApiResult);\n              });\n              var bytesSentByEachWorker = [];\n              var uploadNextPart = function uploadNextPart(workerIndex) {\n                return _await(getNextPart(workerIndex), function (nextPart) {\n                  return _invokeIgnored(function () {\n                    if (nextPart !== undefined) {\n                      var lastBytesSent = 0;\n                      var progress = function progress(_ref) {\n                        var bytesSent = _ref.bytesSent;\n                        if (bytesSentByEachWorker[workerIndex] === undefined) {\n                          bytesSentByEachWorker[workerIndex] = bytesSent;\n                        } else {\n                          bytesSentByEachWorker[workerIndex] -= lastBytesSent;\n                          bytesSentByEachWorker[workerIndex] += bytesSent;\n                        }\n                        lastBytesSent = bytesSent;\n                        var totalBytesSent = bytesSentByEachWorker.reduce(function (a, b) {\n                          return a + b;\n                        });\n                        progressSmoother.setValue(totalBytesSent);\n                      };\n                      return _await(uploadPart(file, nextPart, progress, addCancellationHandler, workerIndex), function () {\n                        return Upload_awaitIgnored(uploadNextPart(workerIndex));\n                      });\n                    }\n                  });\n                });\n              };\n              return _await(Promise.all(_toConsumableArray(Array(maxUploadConcurrency).keys()).map(function (workerIndex) {\n                return _await(uploadNextPart(workerIndex));\n              })), function () {\n                var uploadedFile = Object.assign({\n                  accountId: accountId,\n                  file: file\n                }, uploadMetadata.file);\n                debug(\"File upload completed.\");\n                return uploadedFile;\n              });\n            });\n          }));\n        });\n        var putUploadPart = Upload_async(function (url, content, progress, addCancellationHandler) {\n          var xhr = new XMLHttpRequest();\n          var pending = true;\n          addCancellationHandler(function () {\n            if (pending) {\n              xhr.abort();\n            }\n          });\n          return Upload_finallyRethrows(function () {\n            return _await(new Promise(function (resolve, reject) {\n              xhr.upload.addEventListener(\"progress\", function (evt) {\n                if (evt.lengthComputable) {\n                  progress({\n                    bytesSent: evt.loaded,\n                    bytesTotal: evt.total\n                  });\n                }\n              }, false);\n              xhr.addEventListener(\"load\", function () {\n                // Ensure we always report the progress of a finished upload as 100%.\n                progress({\n                  bytesSent: content.size,\n                  bytesTotal: content.size\n                });\n                if (Math.floor(xhr.status / 100) === 2) {\n                  var etag = xhr.getResponseHeader(\"etag\");\n                  if (etag === null || etag === undefined) {\n                    reject(new Error(\"File upload error: no etag header in upload response.\"));\n                  } else {\n                    resolve({\n                      etag: etag\n                    });\n                  }\n                } else {\n                  reject(new Error(\"File upload error: status code \".concat(xhr.status)));\n                }\n              });\n              xhr.onabort = function () {\n                return reject(new Error(\"File upload cancelled.\"));\n              };\n              xhr.onerror = function () {\n                return reject(new Error(\"File upload error.\"));\n              };\n              xhr.ontimeout = function () {\n                return reject(new Error(\"File upload timeout.\"));\n              };\n              xhr.open(\"PUT\", url);\n              xhr.send(content);\n            }));\n          }, function (_wasThrown, _result) {\n            pending = false;\n            return Upload_rethrow(_wasThrown, _result);\n          });\n        });\n        var uploadPart = Upload_async(function (file, part, progress, addCancellationHandler, workerIndex) {\n          var content = part.range.inclusiveEnd === -1 ? new Blob() : file.slice(part.range.inclusiveStart, part.range.inclusiveEnd + 1);\n          debug(\"Uploading part \".concat(part.uploadPartIndex, \".\"), workerIndex);\n          return _await(putUploadPart(part.uploadUrl, content, progress, addCancellationHandler), function (_ref2) {\n            var etag = _ref2.etag;\n            return _await((0, upload_api_client_upload_js_namespaceObject.completeUploadPart)(getConfig(), accountId, part.uploadId, part.uploadPartIndex, {\n              etag: etag\n            }), function (_completeUploadPart) {\n              handleApiResult(_completeUploadPart);\n              debug(\"Uploaded part \".concat(part.uploadPartIndex, \".\"), workerIndex);\n            });\n          });\n        });\n        var withProgressReporting = Upload_async(function (tickInterval, tick, scope) {\n          var whileReportingResolved;\n          var whileReporting = new Promise(function (resolve) {\n            whileReportingResolved = resolve;\n          });\n          var isReporting = true;\n          var stopReporting = function stopReporting() {\n            if (isReporting) {\n              whileReportingResolved();\n              clearInterval(intervalHandle);\n              isReporting = false;\n            }\n          };\n          var intervalHandle = setInterval(function () {\n            return tick(stopReporting);\n          }, tickInterval);\n          return Upload_finallyRethrows(function () {\n            return Upload_call(scope, function (result) {\n              return _await(whileReporting, function () {\n                return result;\n              });\n            });\n          }, function (_wasThrown2, _result2) {\n            stopReporting();\n            return Upload_rethrow(_wasThrown2, _result2);\n          });\n        });\n        var deleteAccessToken = Upload_async(function () {\n          return Upload_awaitIgnored(deleteNoResponse(accessTokenPath, {}, true // Required, else CDN response's `Set-Cookie` header will be silently ignored.\n          ));\n        });\n\n        var refreshAccessToken = Upload_async(function (authUrl, authHeaders, authSession) {\n          return _continueIgnored(_catch(function () {\n            return Upload_awaitIgnored(authMutex.safe(Upload_async(function () {\n              // Session may have been ended while timer was waiting.\n              if (!authSession.isActive) {\n                return;\n              }\n              return Upload_call(authHeaders, function (_authHeaders) {\n                return _await(getText(authUrl, _authHeaders), function (token) {\n                  return _await(putJsonGetJson(accessTokenPath, {}, {\n                    accessToken: token\n                  }, true // Required, else CDN response's `Set-Cookie` header will be silently ignored.\n                  ), function (setTokenResult) {\n                    authSession.accessToken = setTokenResult.accessToken;\n                    authSession.accessTokenRefreshHandle = window.setTimeout(function () {\n                      refreshAccessToken(authUrl, authHeaders, authSession).then(function () {}, function (e) {\n                        return error(\"Permanent error when refreshing access token: \".concat(e));\n                      });\n                    }, Math.max(0, (setTokenResult.ttlSeconds - refreshBeforeExpirySeconds) * 1000));\n                  });\n                });\n              });\n            })));\n          }, function (e) {\n            // Perform attempts as part of same promise, rather than via a 'setTimeout' so that the 'beginAuthSession' only\n            // returns once an auth session has been successfully established.\n            debug(\"Error when refreshing access token: \".concat(e));\n            return _await(new Promise(function (resolve) {\n              return setTimeout(resolve, retryAuthAfterErrorSeconds * 1000);\n            }), function () {\n              // Todo: is this stack safe?\n              return Upload_awaitIgnored(refreshAccessToken(authUrl, authHeaders, authSession));\n            });\n          }));\n        });\n        var putJsonGetJson = Upload_async(function (url, headers, requestBody, withCredentials) {\n          return _await(nonUploadApiRequest({\n            method: \"PUT\",\n            path: url,\n            headers: headers,\n            body: requestBody\n          }, withCredentials), function (_nonUploadApiRequest) {\n            return _await(handleApiResult(_nonUploadApiRequest));\n          });\n        });\n        var getText = Upload_async(function (url, headers) {\n          return _await(nonUploadApiRequest({\n            method: \"GET\",\n            path: url,\n            headers: headers\n          }, false), function (_nonUploadApiRequest2) {\n            return _await(handleApiResult(_nonUploadApiRequest2));\n          });\n        });\n        var deleteNoResponse = Upload_async(function (url, headers, withCredentials) {\n          return _await(nonUploadApiRequest({\n            method: \"DELETE\",\n            path: url,\n            headers: headers\n          }, withCredentials), function (_nonUploadApiRequest3) {\n            handleApiResult(_nonUploadApiRequest3);\n          });\n        });\n        var handleApiResult = function handleApiResult(result) {\n          var _a;\n          if (result.ok) {\n            return result.body;\n          }\n          var errorResponseMaybe = result.body;\n          if (typeof ((_a = errorResponseMaybe === null || errorResponseMaybe === void 0 ? void 0 : errorResponseMaybe.error) === null || _a === void 0 ? void 0 : _a.code) === \"string\") {\n            throw new UploadApiError(errorResponseMaybe);\n          }\n          throw new Error(\"Unexpected API error.\");\n        };\n        var nonUploadApiRequest = Upload_async(function (options, withCredentials) {\n          return (0, upload_api_client_upload_js_namespaceObject.request)({\n            BASE: options.path,\n            WITH_CREDENTIALS: withCredentials\n          }, Object.assign(Object.assign({}, options), {\n            path: \"\" // We set to \"\" because we're using \"BASE\" above instead.\n          }));\n        });\n\n        var getConfig = function getConfig() {\n          var apiConfig = {\n            BASE: apiUrl,\n            WITH_CREDENTIALS: true\n          };\n          if (authenticateWithApiKey) {\n            apiConfig.USERNAME = \"apikey\";\n            apiConfig.PASSWORD = config.apiKey;\n          }\n          var accessToken = lastAuthSession === null || lastAuthSession === void 0 ? void 0 : lastAuthSession.accessToken;\n          if (headers !== undefined || accessToken !== undefined) {\n            apiConfig.HEADERS = Upload_async(function () {\n              return _await(headers === undefined ? {} : headers(), function (headersFromConfig) {\n                var accessToken = lastAuthSession === null || lastAuthSession === void 0 ? void 0 : lastAuthSession.accessToken; // Re-fetch as there's been an async boundary so state may have changed.\n\n                return Object.assign(Object.assign({}, headersFromConfig), accessToken === undefined ? {} : {\n                  \"authorization-token\": accessToken\n                });\n              }, headers === undefined);\n            });\n          }\n          return apiConfig;\n        };\n        var normalizeMimeType = function normalizeMimeType(mime) {\n          var normal = mime.toLowerCase();\n          var regex = /^[a-z0-9]+\\/[a-z0-9+\\-._]+(?:;[^=]+=[^;]+)*$/; // Sync with 'MimeTypeUnboxed' in 'upload/api'.\n\n          return regex.test(normal) ? normal : undefined;\n        };\n        var debug = function debug(message, workerIndex) {\n          if (debugMode) {\n            console.log(\"\".concat(logPrefix).concat(message).concat(workerIndex !== undefined ? \" (Worker \".concat(workerIndex, \")\") : \"\"));\n          }\n        };\n        var error = function error(message) {\n          console.error(\"\".concat(logPrefix).concat(message));\n        };\n        return {\n          beginAuthSession: beginAuthSession,\n          endAuthSession: endAuthSession,\n          uploadFile: uploadFile,\n          url: url\n        };\n      }\n      ; // CONCATENATED MODULE: ./src/index.ts\n\n      /***/\n    }\n\n    /******/\n  };\n  /************************************************************************/\n  /******/ // The module cache\n  /******/\n  var __webpack_module_cache__ = {};\n  /******/\n  /******/ // The require function\n  /******/\n  function __webpack_require__(moduleId) {\n    /******/ // Check if module is in cache\n    /******/if (__webpack_module_cache__[moduleId]) {\n      /******/return __webpack_module_cache__[moduleId].exports;\n      /******/\n    }\n    /******/ // Create a new module (and put it into the cache)\n    /******/\n    var module = __webpack_module_cache__[moduleId] = {\n      /******/ // no module.id needed\n      /******/ // no module.loaded needed\n      /******/exports: {}\n      /******/\n    };\n    /******/\n    /******/ // Execute the module function\n    /******/\n    __webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n    /******/\n    /******/ // Return the exports of the module\n    /******/\n    return module.exports;\n    /******/\n  }\n  /******/\n  /************************************************************************/\n  /******/ /* webpack/runtime/define property getters */\n  /******/\n  !function () {\n    /******/ // define getter functions for harmony exports\n    /******/__webpack_require__.d = function (exports, definition) {\n      /******/for (var key in definition) {\n        /******/if (__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n          /******/Object.defineProperty(exports, key, {\n            enumerable: true,\n            get: definition[key]\n          });\n          /******/\n        }\n        /******/\n      }\n      /******/\n    };\n    /******/\n  }();\n  /******/\n  /******/ /* webpack/runtime/hasOwnProperty shorthand */\n  /******/\n  !function () {\n    /******/__webpack_require__.o = function (obj, prop) {\n      return Object.prototype.hasOwnProperty.call(obj, prop);\n    };\n    /******/\n  }();\n  /******/\n  /******/ /* webpack/runtime/make namespace object */\n  /******/\n  !function () {\n    /******/ // define __esModule on exports\n    /******/__webpack_require__.r = function (exports) {\n      /******/if (typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n        /******/Object.defineProperty(exports, Symbol.toStringTag, {\n          value: 'Module'\n        });\n        /******/\n      }\n      /******/\n      Object.defineProperty(exports, '__esModule', {\n        value: true\n      });\n      /******/\n    };\n    /******/\n  }();\n  /******/\n  /************************************************************************/\n  /******/ // module exports must be returned from runtime so entry inlining is disabled\n  /******/ // startup\n  /******/ // Load entry module and return exports\n  /******/\n  return __webpack_require__(\"./src/index.ts\");\n  /******/\n}();","map":{"version":3,"names":["module","exports","__webpack_modules__","__unused_webpack_module","__webpack_exports__","__webpack_require__","r","d","Upload","UploadApiError","upload_api_client_upload_js_namespaceObject","require","_call","body","then","direct","result","Promise","resolve","e","reject","_rethrow","thrown","value","_finallyRethrows","finalizer","bind","_empty","_awaitIgnored","_settle","pact","state","s","_Pact","v","o","observer","prototype","onFulfilled","onRejected","callback","_this","_isSettledPact","thenable","_for","test","update","stage","shouldContinue","updateValue","_resumeAfterTest","_resumeAfterBody","_resumeAfterUpdate","_continue","_async","f","args","i","arguments","length","apply","Mutex","mutex","resolver","safe","acquire","_wasThrown","_result","release","undefined","Error","external_progress_smoother_namespaceObject","_typeof","obj","Symbol","iterator","constructor","_defineProperties","target","props","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","Constructor","protoProps","staticProps","_classCallCheck","instance","TypeError","_inherits","subClass","superClass","create","_setPrototypeOf","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf","NewTarget","Reflect","construct","_possibleConstructorReturn","self","call","_assertThisInitialized","ReferenceError","_wrapNativeSuper","Class","_cache","Map","_isNativeFunction","has","get","set","Wrapper","_construct","Parent","a","push","Function","sham","Proxy","Boolean","valueOf","fn","toString","indexOf","p","setPrototypeOf","__proto__","getPrototypeOf","_Error","_super","response","error","message","errorCode","code","details","Upload_rethrow","Upload_finallyRethrows","_continueIgnored","Upload_empty","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","minLen","_arrayLikeToArray","n","slice","name","Array","from","iter","isArray","len","arr2","accountIdLength","Upload_awaitIgnored","specialApiKeyAccountId","Upload_call","specialApiKeys","Upload_async","apiKeyPrefix","_callIgnored","maxUploadConcurrency","_await","refreshBeforeExpirySeconds","_catch","recover","onProgressInterval","_invokeIgnored","retryAuthAfterErrorSeconds","accessTokenPathBase","logPrefix","config","_a","_b","_c","_d","_e","_f","_g","_h","_j","accountId","authMutex","apiUrl","internal","cdnUrl","authenticateWithApiKey","headers","debugMode","debug","lastAuthSession","concat","console","log","apiKey","trim","includes","startsWith","substr","accessTokenPath","beginAuthSession","authUrl","authHeaders","endAuthSession","authSession","accessToken","accessTokenRefreshHandle","isActive","refreshAccessToken","clearTimeout","deleteAccessToken","uploadFile","file","params","cancellationHandlers","addCancellationHandler","ca","cancel","forEach","x","onBegin","beginFileUpload","url","filePath","slugOrParams","defaultSlug","transformation","auth","progressSmoother","ProgressSmoother","maxValue","size","teardownTime","minDelayUntilFirstValue","valueIncreaseDelta","valueIncreaseRatePerSecond","averageTimeBetweenValues","reportProgress","stopReportingProgress","onProgress","bytesSent","smoothedValue","bytesTotal","progress","Math","round","withProgressReporting","uploadRequest","path","metadata","mime","normalizeMimeType","type","originalFileName","protocol","tags","JSON","stringify","beginMultipartUpload","getConfig","_beginMultipartUpload","uploadMetadata","handleApiResult","incUploadIndex","lastUploadIndex","uploadParts","count","nextPartQueue","first","getNextPart","workerIndex","nextPart","pop","uploadPartIndex","getUploadPart","uploadId","bytesSentByEachWorker","uploadNextPart","lastBytesSent","_ref","totalBytesSent","reduce","b","setValue","uploadPart","all","keys","map","uploadedFile","assign","putUploadPart","content","xhr","XMLHttpRequest","pending","abort","upload","addEventListener","evt","lengthComputable","loaded","total","floor","status","etag","getResponseHeader","onabort","onerror","ontimeout","open","send","part","range","inclusiveEnd","Blob","inclusiveStart","uploadUrl","_ref2","completeUploadPart","_completeUploadPart","tickInterval","tick","scope","whileReportingResolved","whileReporting","isReporting","stopReporting","clearInterval","intervalHandle","setInterval","_wasThrown2","_result2","deleteNoResponse","_authHeaders","getText","token","putJsonGetJson","setTokenResult","window","setTimeout","max","ttlSeconds","requestBody","withCredentials","nonUploadApiRequest","method","_nonUploadApiRequest","_nonUploadApiRequest2","_nonUploadApiRequest3","ok","errorResponseMaybe","options","request","BASE","WITH_CREDENTIALS","apiConfig","USERNAME","PASSWORD","HEADERS","headersFromConfig","normal","toLowerCase","regex","__webpack_module_cache__","moduleId","definition","prop","hasOwnProperty","toStringTag"],"sources":["/Users/yupenglei/Documents/geo-react/node_modules/upload-js/dist/main.js"],"sourcesContent":["module.exports =\n/******/ (function() { // webpackBootstrap\n/******/ \t\"use strict\";\n/******/ \tvar __webpack_modules__ = ({\n\n/***/ \"./src/index.ts\":\n/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {\n\n// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, {\n  \"Upload\": function() { return /* reexport */ Upload; },\n  \"UploadApiError\": function() { return /* reexport */ UploadApiError; }\n});\n\n;// CONCATENATED MODULE: external \"@upload-io/upload-api-client-upload-js\"\nvar upload_api_client_upload_js_namespaceObject = require(\"@upload-io/upload-api-client-upload-js\");;\n;// CONCATENATED MODULE: ./src/Mutex.ts\n/**\n * A lightweight mutex. (Other libraries contain too many features and we want to keep the size upload-js down).\n *\n * Characteristics:\n * - Non-reentrant.\n * - Unfair. (Multiple callers awaiting 'acquire' will be granted the mutex in no order.)\n *   - When calling `safe` consecutively with no 'awaits' in-between, the current context will synchronously acquire\n *     the mutex every time.\n */\nfunction _call(body, then, direct) {\n  if (direct) {\n    return then ? then(body()) : body();\n  }\n\n  try {\n    var result = Promise.resolve(body());\n    return then ? result.then(then) : result;\n  } catch (e) {\n    return Promise.reject(e);\n  }\n}\n\nfunction _rethrow(thrown, value) {\n  if (thrown) throw value;\n  return value;\n}\n\nfunction _finallyRethrows(body, finalizer) {\n  try {\n    var result = body();\n  } catch (e) {\n    return finalizer(true, e);\n  }\n\n  if (result && result.then) {\n    return result.then(finalizer.bind(null, false), finalizer.bind(null, true));\n  }\n\n  return finalizer(false, result);\n}\n\nfunction _empty() {}\n\nfunction _awaitIgnored(value, direct) {\n  if (!direct) {\n    return value && value.then ? value.then(_empty) : Promise.resolve();\n  }\n}\n\nfunction _settle(pact, state, value) {\n  if (!pact.s) {\n    if (value instanceof _Pact) {\n      if (value.s) {\n        if (state & 1) {\n          state = value.s;\n        }\n\n        value = value.v;\n      } else {\n        value.o = _settle.bind(null, pact, state);\n        return;\n      }\n    }\n\n    if (value && value.then) {\n      value.then(_settle.bind(null, pact, state), _settle.bind(null, pact, 2));\n      return;\n    }\n\n    pact.s = state;\n    pact.v = value;\n    var observer = pact.o;\n\n    if (observer) {\n      observer(pact);\n    }\n  }\n}\n\nvar _Pact = /*#__PURE__*/function () {\n  function _Pact() {}\n\n  _Pact.prototype.then = function (onFulfilled, onRejected) {\n    var result = new _Pact();\n    var state = this.s;\n\n    if (state) {\n      var callback = state & 1 ? onFulfilled : onRejected;\n\n      if (callback) {\n        try {\n          _settle(result, 1, callback(this.v));\n        } catch (e) {\n          _settle(result, 2, e);\n        }\n\n        return result;\n      } else {\n        return this;\n      }\n    }\n\n    this.o = function (_this) {\n      try {\n        var value = _this.v;\n\n        if (_this.s & 1) {\n          _settle(result, 1, onFulfilled ? onFulfilled(value) : value);\n        } else if (onRejected) {\n          _settle(result, 1, onRejected(value));\n        } else {\n          _settle(result, 2, value);\n        }\n      } catch (e) {\n        _settle(result, 2, e);\n      }\n    };\n\n    return result;\n  };\n\n  return _Pact;\n}();\n\nfunction _isSettledPact(thenable) {\n  return thenable instanceof _Pact && thenable.s & 1;\n}\n\nfunction _for(test, update, body) {\n  var stage;\n\n  for (;;) {\n    var shouldContinue = test();\n\n    if (_isSettledPact(shouldContinue)) {\n      shouldContinue = shouldContinue.v;\n    }\n\n    if (!shouldContinue) {\n      return result;\n    }\n\n    if (shouldContinue.then) {\n      stage = 0;\n      break;\n    }\n\n    var result = body();\n\n    if (result && result.then) {\n      if (_isSettledPact(result)) {\n        result = result.s;\n      } else {\n        stage = 1;\n        break;\n      }\n    }\n\n    if (update) {\n      var updateValue = update();\n\n      if (updateValue && updateValue.then && !_isSettledPact(updateValue)) {\n        stage = 2;\n        break;\n      }\n    }\n  }\n\n  var pact = new _Pact();\n\n  var reject = _settle.bind(null, pact, 2);\n\n  (stage === 0 ? shouldContinue.then(_resumeAfterTest) : stage === 1 ? result.then(_resumeAfterBody) : updateValue.then(_resumeAfterUpdate)).then(void 0, reject);\n  return pact;\n\n  function _resumeAfterBody(value) {\n    result = value;\n\n    do {\n      if (update) {\n        updateValue = update();\n\n        if (updateValue && updateValue.then && !_isSettledPact(updateValue)) {\n          updateValue.then(_resumeAfterUpdate).then(void 0, reject);\n          return;\n        }\n      }\n\n      shouldContinue = test();\n\n      if (!shouldContinue || _isSettledPact(shouldContinue) && !shouldContinue.v) {\n        _settle(pact, 1, result);\n\n        return;\n      }\n\n      if (shouldContinue.then) {\n        shouldContinue.then(_resumeAfterTest).then(void 0, reject);\n        return;\n      }\n\n      result = body();\n\n      if (_isSettledPact(result)) {\n        result = result.v;\n      }\n    } while (!result || !result.then);\n\n    result.then(_resumeAfterBody).then(void 0, reject);\n  }\n\n  function _resumeAfterTest(shouldContinue) {\n    if (shouldContinue) {\n      result = body();\n\n      if (result && result.then) {\n        result.then(_resumeAfterBody).then(void 0, reject);\n      } else {\n        _resumeAfterBody(result);\n      }\n    } else {\n      _settle(pact, 1, result);\n    }\n  }\n\n  function _resumeAfterUpdate() {\n    if (shouldContinue = test()) {\n      if (shouldContinue.then) {\n        shouldContinue.then(_resumeAfterTest).then(void 0, reject);\n      } else {\n        _resumeAfterTest(shouldContinue);\n      }\n    } else {\n      _settle(pact, 1, result);\n    }\n  }\n}\n\nfunction _continue(value, then) {\n  return value && value.then ? value.then(then) : then(value);\n}\n\nfunction _async(f) {\n  return function () {\n    for (var args = [], i = 0; i < arguments.length; i++) {\n      args[i] = arguments[i];\n    }\n\n    try {\n      return Promise.resolve(f.apply(this, args));\n    } catch (e) {\n      return Promise.reject(e);\n    }\n  };\n}\n\nfunction Mutex() {\n  var mutex;\n  var resolver;\n\n  var safe = function safe(callback) {\n    return _call(acquire, function () {\n      return _finallyRethrows(callback, function (_wasThrown, _result) {\n        release();\n        return _rethrow(_wasThrown, _result);\n      });\n    });\n  };\n\n  var acquire = _async(function () {\n    // Loop necessary for when multiple calls are made to 'acquire' before a 'release' is called, else the call to\n    // 'release' will resume every caller currently waiting on 'acquire'.\n    // eslint-disable-next-line no-unmodified-loop-condition\n    return _continue(_for(function () {\n      return mutex !== undefined;\n    }, void 0, function () {\n      return _awaitIgnored(mutex);\n    }), function () {\n      mutex = new Promise(function (resolve) {\n        resolver = resolve;\n      });\n    });\n  });\n\n  var release = function release() {\n    if (resolver === undefined) {\n      throw new Error(\"Unable to release mutex: already released.\");\n    }\n\n    resolver();\n    resolver = undefined;\n    mutex = undefined;\n  };\n\n  return {\n    safe: safe\n  };\n}\n;// CONCATENATED MODULE: external \"progress-smoother\"\nvar external_progress_smoother_namespaceObject = require(\"progress-smoother\");;\n;// CONCATENATED MODULE: ./src/UploadApiError.ts\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _wrapNativeSuper(Class) { var _cache = typeof Map === \"function\" ? new Map() : undefined; _wrapNativeSuper = function _wrapNativeSuper(Class) { if (Class === null || !_isNativeFunction(Class)) return Class; if (typeof Class !== \"function\") { throw new TypeError(\"Super expression must either be null or a function\"); } if (typeof _cache !== \"undefined\") { if (_cache.has(Class)) return _cache.get(Class); _cache.set(Class, Wrapper); } function Wrapper() { return _construct(Class, arguments, _getPrototypeOf(this).constructor); } Wrapper.prototype = Object.create(Class.prototype, { constructor: { value: Wrapper, enumerable: false, writable: true, configurable: true } }); return _setPrototypeOf(Wrapper, Class); }; return _wrapNativeSuper(Class); }\n\nfunction _construct(Parent, args, Class) { if (_isNativeReflectConstruct()) { _construct = Reflect.construct; } else { _construct = function _construct(Parent, args, Class) { var a = [null]; a.push.apply(a, args); var Constructor = Function.bind.apply(Parent, a); var instance = new Constructor(); if (Class) _setPrototypeOf(instance, Class.prototype); return instance; }; } return _construct.apply(null, arguments); }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _isNativeFunction(fn) { return Function.toString.call(fn).indexOf(\"[native code]\") !== -1; }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nvar UploadApiError = /*#__PURE__*/function (_Error) {\n  _inherits(UploadApiError, _Error);\n\n  var _super = _createSuper(UploadApiError);\n\n  function UploadApiError(response) {\n    var _this;\n\n    _classCallCheck(this, UploadApiError);\n\n    _this = _super.call(this, response.error.message);\n    _this.errorCode = response.error.code;\n    _this.details = response.error.details;\n    return _this;\n  }\n\n  return _createClass(UploadApiError);\n}( /*#__PURE__*/_wrapNativeSuper(Error));\n;// CONCATENATED MODULE: ./src/Upload.ts\nfunction Upload_rethrow(thrown, value) {\n  if (thrown) throw value;\n  return value;\n}\n\nfunction Upload_finallyRethrows(body, finalizer) {\n  try {\n    var result = body();\n  } catch (e) {\n    return finalizer(true, e);\n  }\n\n  if (result && result.then) {\n    return result.then(finalizer.bind(null, false), finalizer.bind(null, true));\n  }\n\n  return finalizer(false, result);\n}\n\nfunction _continueIgnored(value) {\n  if (value && value.then) {\n    return value.then(Upload_empty);\n  }\n}\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n\n\n\n\n\nfunction Upload_empty() {}\n\nvar accountIdLength = 7; // Sync with: upload/shared/**/AccountIdUtils\n\nfunction Upload_awaitIgnored(value, direct) {\n  if (!direct) {\n    return value && value.then ? value.then(Upload_empty) : Promise.resolve();\n  }\n}\n\nvar specialApiKeyAccountId = \"W142hJk\";\n\nfunction Upload_call(body, then, direct) {\n  if (direct) {\n    return then ? then(body()) : body();\n  }\n\n  try {\n    var result = Promise.resolve(body());\n    return then ? result.then(then) : result;\n  } catch (e) {\n    return Promise.reject(e);\n  }\n}\n\nvar specialApiKeys = [\"free\", \"demo\"];\n\nfunction Upload_async(f) {\n  return function () {\n    for (var args = [], i = 0; i < arguments.length; i++) {\n      args[i] = arguments[i];\n    }\n\n    try {\n      return Promise.resolve(f.apply(this, args));\n    } catch (e) {\n      return Promise.reject(e);\n    }\n  };\n}\n\nvar apiKeyPrefix = \"public_\";\n\nfunction _callIgnored(body, direct) {\n  return Upload_call(body, Upload_empty, direct);\n}\n\nvar maxUploadConcurrency = 5;\n\nfunction _await(value, then, direct) {\n  if (direct) {\n    return then ? then(value) : value;\n  }\n\n  if (!value || !value.then) {\n    value = Promise.resolve(value);\n  }\n\n  return then ? value.then(then) : value;\n}\n\nvar refreshBeforeExpirySeconds = 20;\n\nfunction _catch(body, recover) {\n  try {\n    var result = body();\n  } catch (e) {\n    return recover(e);\n  }\n\n  if (result && result.then) {\n    return result.then(void 0, recover);\n  }\n\n  return result;\n}\n\nvar onProgressInterval = 100;\n\nfunction _invokeIgnored(body) {\n  var result = body();\n\n  if (result && result.then) {\n    return result.then(Upload_empty);\n  }\n}\n\nvar retryAuthAfterErrorSeconds = 5;\nvar accessTokenPathBase = \"/api/v1/access_tokens/\";\nvar logPrefix = \"[upload-js] \";\n/**\n * You should instantiate one instance of this class in your web app.\n *\n * Try using:\n *\n *    Upload({apiKey: \"free\"})\n *\n * This is particularly important when using the 'beginAuthSession' and\n * 'endAuthSession' methods, as you don't want multiple running instances of the\n * auth process in your web application.\n */\n\nfunction Upload(config) {\n  // ----------------\n  // READONLY MEMBERS\n  // ----------------\n  var _a, _b, _c, _d, _e, _f, _g, _h, _j;\n\n  var accountId;\n  var authMutex = Mutex();\n  var apiUrl = (_b = (_a = config.internal) === null || _a === void 0 ? void 0 : _a.apiUrl) !== null && _b !== void 0 ? _b : \"https://api.upload.io\";\n  var cdnUrl = (_d = (_c = config.internal) === null || _c === void 0 ? void 0 : _c.cdnUrl) !== null && _d !== void 0 ? _d : \"https://upcdn.io\";\n  var authenticateWithApiKey = (_f = (_e = config.internal) === null || _e === void 0 ? void 0 : _e.authenticateWithApiKey) !== null && _f !== void 0 ? _f : true;\n  var headers = (_g = config.internal) === null || _g === void 0 ? void 0 : _g.headers;\n  var debugMode = config.debug === true; // ------------------\n  // READ/WRITE MEMBERS\n  // ------------------\n\n  var lastAuthSession; // ----------------\n  // CONSTRUCTOR\n  // ----------------\n\n  if ((config !== null && config !== void 0 ? config : undefined) === undefined) {\n    throw new Error(\"\".concat(logPrefix, \"Config parameter required.\"));\n  }\n\n  if (config.debug === true) {\n    console.log(\"\".concat(logPrefix, \"Initialized with API key '\").concat(config.apiKey, \"'\"));\n  }\n\n  if (((_h = config.apiKey) !== null && _h !== void 0 ? _h : undefined) === undefined) {\n    throw new Error(\"\".concat(logPrefix, \"Please provide an API key via the 'apiKey' config parameter.\"));\n  }\n\n  if (config.apiKey.trim() !== config.apiKey) {\n    // We do not support API keys with whitespace (by trimming ourselves) because otherwise we'd need to support this\n    // everywhere in perpetuity (since removing the trimming would be a breaking change).\n    throw new Error(\"\".concat(logPrefix, \"API key needs trimming (whitespace detected).\"));\n  } // Non-api-key authentication is required by Upload Dashboard, which uses bearer tokens instead of API keys because\n  // the user may not have any active API keys, but might still want to upload files via the Upload Dashboard.\n\n\n  if (((_j = config.internal) === null || _j === void 0 ? void 0 : _j.authenticateWithApiKey) === false) {\n    accountId = config.internal.accountId;\n  } else {\n    if (specialApiKeys.includes(config.apiKey)) {\n      accountId = specialApiKeyAccountId;\n    } else {\n      if (!config.apiKey.startsWith(apiKeyPrefix)) {\n        throw new Error(\"\".concat(logPrefix, \"API key must begin with \\\"\").concat(apiKeyPrefix, \"\\\".\"));\n      }\n\n      accountId = config.apiKey.substr(apiKeyPrefix.length, accountIdLength);\n\n      if (accountId.length !== accountIdLength) {\n        throw new Error(\"\".concat(logPrefix, \"API key is too short!\"));\n      }\n    }\n  }\n\n  var accessTokenPath = \"\".concat(cdnUrl).concat(accessTokenPathBase).concat(accountId); // ----------------\n  // PUBLIC METHODS\n  // ----------------\n\n  var beginAuthSession = function beginAuthSession(authUrl, authHeaders) {\n    return Upload_call(endAuthSession, function () {\n      var authSession = {\n        accessToken: undefined,\n        accessTokenRefreshHandle: undefined,\n        isActive: true\n      }; // Does not need to be inside the mutex since the environment is single-threaded, and we have not async-yielded\n      // since the mutex from 'endAuthSession' was relinquished (meaning we still have execution, so we know a) nothing\n      // can interject and b) nothing has interjected since the lock was relinquished).\n\n      lastAuthSession = authSession;\n      return Upload_awaitIgnored(refreshAccessToken(authUrl, authHeaders, authSession));\n    });\n  };\n\n  var endAuthSession = Upload_async(function () {\n    return Upload_awaitIgnored(authMutex.safe(Upload_async(function () {\n      if (lastAuthSession === undefined) {\n        return;\n      }\n\n      var authSession = lastAuthSession;\n      lastAuthSession = undefined;\n\n      if (authSession.accessTokenRefreshHandle !== undefined) {\n        clearTimeout(authSession.accessTokenRefreshHandle);\n      }\n\n      authSession.isActive = false;\n      return _callIgnored(deleteAccessToken);\n    })));\n  });\n\n  var uploadFile = Upload_async(function (file) {\n    var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    // Initial progress (raised immediately and synchronously).\n    var cancellationHandlers = [];\n\n    var addCancellationHandler = function addCancellationHandler(ca) {\n      cancellationHandlers.push(ca);\n    };\n\n    var cancel = function cancel() {\n      return cancellationHandlers.forEach(function (x) {\n        return x();\n      });\n    };\n\n    if (params.onBegin !== undefined) {\n      params.onBegin({\n        cancel: cancel\n      });\n    }\n\n    return _catch(function () {\n      return _await(beginFileUpload(file, params, addCancellationHandler));\n    }, function (e) {\n      cancel();\n      throw e;\n    });\n  });\n\n  var url = function url(filePath, slugOrParams) {\n    var _a;\n\n    var defaultSlug = \"raw\";\n    var params = typeof slugOrParams === \"string\" ? {\n      transformation: slugOrParams\n    } : slugOrParams;\n    return \"\".concat(cdnUrl, \"/\").concat(accountId, \"/\").concat((_a = params === null || params === void 0 ? void 0 : params.transformation) !== null && _a !== void 0 ? _a : defaultSlug).concat(filePath).concat((params === null || params === void 0 ? void 0 : params.auth) === true ? \"?_auth=true\" : \"\");\n  }; // ----------------\n  // PRIVATE METHODS\n  // ----------------\n\n\n  var beginFileUpload = Upload_async(function (file, params, addCancellationHandler) {\n    var progressSmoother = (0,external_progress_smoother_namespaceObject.ProgressSmoother)({\n      maxValue: file.size,\n      teardownTime: 1000,\n      minDelayUntilFirstValue: 2000,\n      valueIncreaseDelta: 200 * 1024,\n      valueIncreaseRatePerSecond: 50 * 1024,\n      averageTimeBetweenValues: 1000 // When running, XHR should (hopefully) report at least every second, regardless of connection speed.\n\n    });\n\n    var reportProgress = function reportProgress(stopReportingProgress) {\n      if (params.onProgress === undefined) {\n        stopReportingProgress(); // Important to call this, as outer function awaits this call when the download ends.\n      } else {\n        var bytesSent = progressSmoother.smoothedValue();\n        var bytesTotal = file.size;\n\n        if (bytesSent === bytesTotal) {\n          stopReportingProgress();\n        }\n\n        params.onProgress({\n          bytesSent: bytesSent,\n          bytesTotal: bytesTotal,\n          progress: Math.round(bytesSent / bytesTotal * 100)\n        });\n      }\n    };\n\n    return withProgressReporting(onProgressInterval, reportProgress, Upload_async(function () {\n      var uploadRequest = {\n        path: params.path,\n        metadata: params.metadata,\n        mime: normalizeMimeType(file.type),\n        originalFileName: file.name,\n        protocol: \"1.1\",\n        size: file.size,\n        tags: params.tags\n      };\n      debug(\"Initiating file upload. Params = \".concat(JSON.stringify(uploadRequest)));\n      return _await((0,upload_api_client_upload_js_namespaceObject.beginMultipartUpload)(getConfig(), accountId, uploadRequest), function (_beginMultipartUpload) {\n        var uploadMetadata = handleApiResult(_beginMultipartUpload);\n        debug(\"Initiated file upload. Metadata = \".concat(JSON.stringify(uploadMetadata)));\n\n        var incUploadIndex = function () {\n          var lastUploadIndex = 0;\n          return function () {\n            if (lastUploadIndex === uploadMetadata.uploadParts.count - 1) {\n              return undefined;\n            }\n\n            return ++lastUploadIndex;\n          };\n        }();\n\n        var nextPartQueue = [uploadMetadata.uploadParts.first];\n\n        var getNextPart = Upload_async(function (workerIndex) {\n          var nextPart = nextPartQueue.pop();\n\n          if (nextPart !== undefined) {\n            debug(\"Dequeued part \".concat(nextPart.uploadPartIndex, \".\"), workerIndex);\n            return nextPart;\n          }\n\n          var uploadPartIndex = incUploadIndex();\n\n          if (uploadPartIndex === undefined) {\n            debug(\"No parts remaining.\", workerIndex);\n            return undefined;\n          }\n\n          debug(\"Fetching metadata for part \".concat(uploadPartIndex, \".\"), workerIndex);\n          return _await((0,upload_api_client_upload_js_namespaceObject.getUploadPart)(getConfig(), accountId, uploadMetadata.uploadId, uploadPartIndex), handleApiResult);\n        });\n\n        var bytesSentByEachWorker = [];\n\n        var uploadNextPart = function uploadNextPart(workerIndex) {\n          return _await(getNextPart(workerIndex), function (nextPart) {\n            return _invokeIgnored(function () {\n              if (nextPart !== undefined) {\n                var lastBytesSent = 0;\n\n                var progress = function progress(_ref) {\n                  var bytesSent = _ref.bytesSent;\n\n                  if (bytesSentByEachWorker[workerIndex] === undefined) {\n                    bytesSentByEachWorker[workerIndex] = bytesSent;\n                  } else {\n                    bytesSentByEachWorker[workerIndex] -= lastBytesSent;\n                    bytesSentByEachWorker[workerIndex] += bytesSent;\n                  }\n\n                  lastBytesSent = bytesSent;\n                  var totalBytesSent = bytesSentByEachWorker.reduce(function (a, b) {\n                    return a + b;\n                  });\n                  progressSmoother.setValue(totalBytesSent);\n                };\n\n                return _await(uploadPart(file, nextPart, progress, addCancellationHandler, workerIndex), function () {\n                  return Upload_awaitIgnored(uploadNextPart(workerIndex));\n                });\n              }\n            });\n          });\n        };\n\n        return _await(Promise.all(_toConsumableArray(Array(maxUploadConcurrency).keys()).map(function (workerIndex) {\n          return _await(uploadNextPart(workerIndex));\n        })), function () {\n          var uploadedFile = Object.assign({\n            accountId: accountId,\n            file: file\n          }, uploadMetadata.file);\n          debug(\"File upload completed.\");\n          return uploadedFile;\n        });\n      });\n    }));\n  });\n\n  var putUploadPart = Upload_async(function (url, content, progress, addCancellationHandler) {\n    var xhr = new XMLHttpRequest();\n    var pending = true;\n    addCancellationHandler(function () {\n      if (pending) {\n        xhr.abort();\n      }\n    });\n    return Upload_finallyRethrows(function () {\n      return _await(new Promise(function (resolve, reject) {\n        xhr.upload.addEventListener(\"progress\", function (evt) {\n          if (evt.lengthComputable) {\n            progress({\n              bytesSent: evt.loaded,\n              bytesTotal: evt.total\n            });\n          }\n        }, false);\n        xhr.addEventListener(\"load\", function () {\n          // Ensure we always report the progress of a finished upload as 100%.\n          progress({\n            bytesSent: content.size,\n            bytesTotal: content.size\n          });\n\n          if (Math.floor(xhr.status / 100) === 2) {\n            var etag = xhr.getResponseHeader(\"etag\");\n\n            if (etag === null || etag === undefined) {\n              reject(new Error(\"File upload error: no etag header in upload response.\"));\n            } else {\n              resolve({\n                etag: etag\n              });\n            }\n          } else {\n            reject(new Error(\"File upload error: status code \".concat(xhr.status)));\n          }\n        });\n\n        xhr.onabort = function () {\n          return reject(new Error(\"File upload cancelled.\"));\n        };\n\n        xhr.onerror = function () {\n          return reject(new Error(\"File upload error.\"));\n        };\n\n        xhr.ontimeout = function () {\n          return reject(new Error(\"File upload timeout.\"));\n        };\n\n        xhr.open(\"PUT\", url);\n        xhr.send(content);\n      }));\n    }, function (_wasThrown, _result) {\n      pending = false;\n      return Upload_rethrow(_wasThrown, _result);\n    });\n  });\n\n  var uploadPart = Upload_async(function (file, part, progress, addCancellationHandler, workerIndex) {\n    var content = part.range.inclusiveEnd === -1 ? new Blob() : file.slice(part.range.inclusiveStart, part.range.inclusiveEnd + 1);\n    debug(\"Uploading part \".concat(part.uploadPartIndex, \".\"), workerIndex);\n    return _await(putUploadPart(part.uploadUrl, content, progress, addCancellationHandler), function (_ref2) {\n      var etag = _ref2.etag;\n      return _await((0,upload_api_client_upload_js_namespaceObject.completeUploadPart)(getConfig(), accountId, part.uploadId, part.uploadPartIndex, {\n        etag: etag\n      }), function (_completeUploadPart) {\n        handleApiResult(_completeUploadPart);\n        debug(\"Uploaded part \".concat(part.uploadPartIndex, \".\"), workerIndex);\n      });\n    });\n  });\n\n  var withProgressReporting = Upload_async(function (tickInterval, tick, scope) {\n    var whileReportingResolved;\n    var whileReporting = new Promise(function (resolve) {\n      whileReportingResolved = resolve;\n    });\n    var isReporting = true;\n\n    var stopReporting = function stopReporting() {\n      if (isReporting) {\n        whileReportingResolved();\n        clearInterval(intervalHandle);\n        isReporting = false;\n      }\n    };\n\n    var intervalHandle = setInterval(function () {\n      return tick(stopReporting);\n    }, tickInterval);\n    return Upload_finallyRethrows(function () {\n      return Upload_call(scope, function (result) {\n        return _await(whileReporting, function () {\n          return result;\n        });\n      });\n    }, function (_wasThrown2, _result2) {\n      stopReporting();\n      return Upload_rethrow(_wasThrown2, _result2);\n    });\n  });\n\n  var deleteAccessToken = Upload_async(function () {\n    return Upload_awaitIgnored(deleteNoResponse(accessTokenPath, {}, true // Required, else CDN response's `Set-Cookie` header will be silently ignored.\n    ));\n  });\n\n  var refreshAccessToken = Upload_async(function (authUrl, authHeaders, authSession) {\n    return _continueIgnored(_catch(function () {\n      return Upload_awaitIgnored(authMutex.safe(Upload_async(function () {\n        // Session may have been ended while timer was waiting.\n        if (!authSession.isActive) {\n          return;\n        }\n\n        return Upload_call(authHeaders, function (_authHeaders) {\n          return _await(getText(authUrl, _authHeaders), function (token) {\n            return _await(putJsonGetJson(accessTokenPath, {}, {\n              accessToken: token\n            }, true // Required, else CDN response's `Set-Cookie` header will be silently ignored.\n            ), function (setTokenResult) {\n              authSession.accessToken = setTokenResult.accessToken;\n              authSession.accessTokenRefreshHandle = window.setTimeout(function () {\n                refreshAccessToken(authUrl, authHeaders, authSession).then(function () {}, function (e) {\n                  return error(\"Permanent error when refreshing access token: \".concat(e));\n                });\n              }, Math.max(0, (setTokenResult.ttlSeconds - refreshBeforeExpirySeconds) * 1000));\n            });\n          });\n        });\n      })));\n    }, function (e) {\n      // Perform attempts as part of same promise, rather than via a 'setTimeout' so that the 'beginAuthSession' only\n      // returns once an auth session has been successfully established.\n      debug(\"Error when refreshing access token: \".concat(e));\n      return _await(new Promise(function (resolve) {\n        return setTimeout(resolve, retryAuthAfterErrorSeconds * 1000);\n      }), function () {\n        // Todo: is this stack safe?\n        return Upload_awaitIgnored(refreshAccessToken(authUrl, authHeaders, authSession));\n      });\n    }));\n  });\n\n  var putJsonGetJson = Upload_async(function (url, headers, requestBody, withCredentials) {\n    return _await(nonUploadApiRequest({\n      method: \"PUT\",\n      path: url,\n      headers: headers,\n      body: requestBody\n    }, withCredentials), function (_nonUploadApiRequest) {\n      return _await(handleApiResult(_nonUploadApiRequest));\n    });\n  });\n\n  var getText = Upload_async(function (url, headers) {\n    return _await(nonUploadApiRequest({\n      method: \"GET\",\n      path: url,\n      headers: headers\n    }, false), function (_nonUploadApiRequest2) {\n      return _await(handleApiResult(_nonUploadApiRequest2));\n    });\n  });\n\n  var deleteNoResponse = Upload_async(function (url, headers, withCredentials) {\n    return _await(nonUploadApiRequest({\n      method: \"DELETE\",\n      path: url,\n      headers: headers\n    }, withCredentials), function (_nonUploadApiRequest3) {\n      handleApiResult(_nonUploadApiRequest3);\n    });\n  });\n\n  var handleApiResult = function handleApiResult(result) {\n    var _a;\n\n    if (result.ok) {\n      return result.body;\n    }\n\n    var errorResponseMaybe = result.body;\n\n    if (typeof ((_a = errorResponseMaybe === null || errorResponseMaybe === void 0 ? void 0 : errorResponseMaybe.error) === null || _a === void 0 ? void 0 : _a.code) === \"string\") {\n      throw new UploadApiError(errorResponseMaybe);\n    }\n\n    throw new Error(\"Unexpected API error.\");\n  };\n\n  var nonUploadApiRequest = Upload_async(function (options, withCredentials) {\n    return (0,upload_api_client_upload_js_namespaceObject.request)({\n      BASE: options.path,\n      WITH_CREDENTIALS: withCredentials\n    }, Object.assign(Object.assign({}, options), {\n      path: \"\" // We set to \"\" because we're using \"BASE\" above instead.\n\n    }));\n  });\n\n  var getConfig = function getConfig() {\n    var apiConfig = {\n      BASE: apiUrl,\n      WITH_CREDENTIALS: true\n    };\n\n    if (authenticateWithApiKey) {\n      apiConfig.USERNAME = \"apikey\";\n      apiConfig.PASSWORD = config.apiKey;\n    }\n\n    var accessToken = lastAuthSession === null || lastAuthSession === void 0 ? void 0 : lastAuthSession.accessToken;\n\n    if (headers !== undefined || accessToken !== undefined) {\n      apiConfig.HEADERS = Upload_async(function () {\n        return _await(headers === undefined ? {} : headers(), function (headersFromConfig) {\n          var accessToken = lastAuthSession === null || lastAuthSession === void 0 ? void 0 : lastAuthSession.accessToken; // Re-fetch as there's been an async boundary so state may have changed.\n\n          return Object.assign(Object.assign({}, headersFromConfig), accessToken === undefined ? {} : {\n            \"authorization-token\": accessToken\n          });\n        }, headers === undefined);\n      });\n    }\n\n    return apiConfig;\n  };\n\n  var normalizeMimeType = function normalizeMimeType(mime) {\n    var normal = mime.toLowerCase();\n    var regex = /^[a-z0-9]+\\/[a-z0-9+\\-._]+(?:;[^=]+=[^;]+)*$/; // Sync with 'MimeTypeUnboxed' in 'upload/api'.\n\n    return regex.test(normal) ? normal : undefined;\n  };\n\n  var debug = function debug(message, workerIndex) {\n    if (debugMode) {\n      console.log(\"\".concat(logPrefix).concat(message).concat(workerIndex !== undefined ? \" (Worker \".concat(workerIndex, \")\") : \"\"));\n    }\n  };\n\n  var error = function error(message) {\n    console.error(\"\".concat(logPrefix).concat(message));\n  };\n\n  return {\n    beginAuthSession: beginAuthSession,\n    endAuthSession: endAuthSession,\n    uploadFile: uploadFile,\n    url: url\n  };\n}\n;// CONCATENATED MODULE: ./src/index.ts\n\n\n\n/***/ })\n\n/******/ \t});\n/************************************************************************/\n/******/ \t// The module cache\n/******/ \tvar __webpack_module_cache__ = {};\n/******/ \t\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(__webpack_module_cache__[moduleId]) {\n/******/ \t\t\treturn __webpack_module_cache__[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = __webpack_module_cache__[moduleId] = {\n/******/ \t\t\t// no module.id needed\n/******/ \t\t\t// no module.loaded needed\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/ \t\n/******/ \t\t// Execute the module function\n/******/ \t\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n/******/ \t\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/ \t\n/************************************************************************/\n/******/ \t/* webpack/runtime/define property getters */\n/******/ \t!function() {\n/******/ \t\t// define getter functions for harmony exports\n/******/ \t\t__webpack_require__.d = function(exports, definition) {\n/******/ \t\t\tfor(var key in definition) {\n/******/ \t\t\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n/******/ \t\t\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n/******/ \t\t\t\t}\n/******/ \t\t\t}\n/******/ \t\t};\n/******/ \t}();\n/******/ \t\n/******/ \t/* webpack/runtime/hasOwnProperty shorthand */\n/******/ \t!function() {\n/******/ \t\t__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }\n/******/ \t}();\n/******/ \t\n/******/ \t/* webpack/runtime/make namespace object */\n/******/ \t!function() {\n/******/ \t\t// define __esModule on exports\n/******/ \t\t__webpack_require__.r = function(exports) {\n/******/ \t\t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t\t}\n/******/ \t\t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t\t};\n/******/ \t}();\n/******/ \t\n/************************************************************************/\n/******/ \t// module exports must be returned from runtime so entry inlining is disabled\n/******/ \t// startup\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(\"./src/index.ts\");\n/******/ })()\n;"],"mappings":"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"},"metadata":{},"sourceType":"script"}